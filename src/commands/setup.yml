---
description: >
  Setup circleci tunnel for private connectivity

parameters:
  ngrok-api-token:
    type: env_var_name
    description: "Environment variable containing the ngrok API token"
    default: NGROK_API_TOKEN
  ip-policy-id:
    type: env_var_name
    description: "The IP policy ID for circleci tunnel"
    default: CIRCLE_IP_POLICY_ID
  tcp-address:
    type: string
    description: "TCP address for circleci tunnel"
    default: "1.tcp.ngrok.io"
  tcp-port:
    type: string
    description: "TCP port for circleci tunnel"
    default: "28402"

steps:
  - run:
      environment:
        NGROK_API_TOKEN: ${<< parameters.ngrok-api-token >>}
        IP_POLICY_ID: << parameters.ip-policy-id >>
        TCP_ADDR: << parameters.tcp-address >>
        TCP_PORT: << parameters.tcp-port >>
      name: Setup tunnel
      command: <<include(scripts/setup.sh)>>
